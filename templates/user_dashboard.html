{% extends "base.html" %}

{% block title %}My Dashboard - ServiceHub{% endblock %}

{% block extra_css %}
<style>
    .dashboard-header {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: var(--white);
        padding: 2rem 0;
        margin-bottom: 2rem;
    }
    
    .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: var(--white);
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        text-align: center;
        border-left: 4px solid var(--primary-color);
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: var(--primary-color);
        display: block;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        color: var(--gray-600);
        font-size: 0.9rem;
    }
    
    .bookings-section {
        background: var(--white);
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
    }
    
    .section-header {
        background: var(--gray-100);
        padding: 1.5rem;
        border-bottom: 1px solid var(--gray-200);
        display: flex;
        justify-content: between;
        align-items: center;
    }
    
    .booking-item {
        padding: 1.5rem;
        border-bottom: 1px solid var(--gray-200);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: var(--transition);
    }
    
    .booking-item:hover {
        background: var(--gray-50);
    }
    
    .booking-item:last-child {
        border-bottom: none;
    }
    
    .booking-info h4 {
        margin-bottom: 0.5rem;
        color: var(--dark-color);
    }
    
    .booking-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.9rem;
        color: var(--gray-600);
    }
    
    .booking-meta span {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: uppercase;
    }
    
    .status-pending {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-confirmed {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .status-completed {
        background: #d4edda;
        color: #155724;
    }
    
    .status-cancelled {
        background: #f8d7da;
        color: #721c24;
    }
    
    .booking-amount {
        font-size: 1.25rem;
        font-weight: bold;
        color: var(--primary-color);
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        color: var(--gray-500);
    }
    
    .empty-state i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }
    
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .action-card {
        background: var(--white);
        padding: 2rem;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        text-align: center;
        transition: var(--transition);
        border: 1px solid var(--gray-200);
    }
    
    .action-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--box-shadow-lg);
        border-color: var(--primary-color);
    }
    
    .action-card i {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
    }
    
    .action-card h3 {
        margin-bottom: 0.5rem;
        color: var(--dark-color);
    }
    
    .action-card p {
        color: var(--gray-600);
        margin-bottom: 1.5rem;
    }
    
    .action-card .btn {
        width: 100%;
    }
    
    @media (max-width: 768px) {
        .dashboard-stats {
            grid-template-columns: 1fr;
        }
        
        .booking-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .booking-meta {
            flex-direction: column;
            gap: 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="dashboard-header">
    <div class="container">
        <h1><i class="fas fa-tachometer-alt"></i> Welcome, {{ user.full_name }}!</h1>
        <p style="font-size: 1.1rem; opacity: 0.9;">Manage your bookings and discover new services</p>
    </div>
</div>

<div class="container">
    <!-- Dashboard Stats -->
    <div class="dashboard-stats">
        <div class="stat-card">
            <span class="stat-number">{{ bookings|length }}</span>
            <div class="stat-label">Total Bookings</div>
        </div>
        <div class="stat-card">
            <span class="stat-number">₹{{ "%.0f"|format(total_spent) }}</span>
            <div class="stat-label">Total Spent</div>
        </div>
        <div class="stat-card">
            <span class="stat-number">
                {% set active_bookings = bookings|selectattr('status', 'in', ['pending', 'confirmed'])|list %}
                {{ active_bookings|length }}
            </span>
            <div class="stat-label">Active Bookings</div>
        </div>
        <div class="stat-card">
            <span class="stat-number">
                {% set completed_bookings = bookings|selectattr('status', 'equalto', 'completed')|list %}
                {{ completed_bookings|length }}
            </span>
            <div class="stat-label">Completed Services</div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <div class="action-card">
            <i class="fas fa-search"></i>
            <h3>Find Services</h3>
            <p>Browse our wide range of professional services</p>
            <a href="{{ url_for('browse_services') }}" class="btn btn-primary">
                <i class="fas fa-search"></i> Browse Services
            </a>
        </div>
        <div class="action-card">
            <i class="fas fa-users"></i>
            <h3>Find Providers</h3>
            <p>Connect with verified service providers</p>
            <a href="{{ url_for('browse_providers') }}" class="btn btn-primary">
                <i class="fas fa-users"></i> Browse Providers
            </a>
        </div>
        <div class="action-card">
            <i class="fas fa-calendar-plus"></i>
            <h3>Book a Service</h3>
            <p>Schedule your next service appointment</p>
            <a href="{{ url_for('browse_services') }}" class="btn btn-primary">
                <i class="fas fa-calendar-plus"></i> Book Now
            </a>
        </div>
    </div>

    <!-- Recent Bookings -->
    <div class="bookings-section">
        <div class="section-header">
            <h2><i class="fas fa-calendar-alt"></i> Recent Bookings</h2>
            {% if bookings|length > 5 %}
                <a href="#" class="btn btn-outline-primary btn-sm">View All</a>
            {% endif %}
        </div>
        
        {% if bookings %}
            {% for booking in bookings[:10] %}
            <div class="booking-item">
                <div class="booking-info">
                    <h4>{{ booking.service_name }}</h4>
                    <div class="booking-meta">
                        <span><i class="fas fa-building"></i> {{ booking.business_name }}</span>
                        <span><i class="fas fa-calendar"></i> {{ booking.booking_date }}</span>
                        <span><i class="fas fa-clock"></i> {{ booking.booking_time }}</span>
                        <span><i class="fas fa-hourglass"></i> {{ booking.duration_hours }} hour{% if booking.duration_hours > 1 %}s{% endif %}</span>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div class="booking-amount">₹{{ booking.total_amount }}</div>
                    <div class="mt-2">
                        <span class="status-badge status-{{ booking.status }}">
                            {{ booking.status|title }}
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-calendar-times"></i>
                <h3>No bookings yet</h3>
                <p>Start by browsing our services and booking your first appointment</p>
                <a href="{{ url_for('browse_services') }}" class="btn btn-primary">
                    <i class="fas fa-search"></i> Browse Services
                </a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Add any interactive functionality here
document.addEventListener('DOMContentLoaded', function() {
    // Animate stat numbers on load
    const statNumbers = document.querySelectorAll('.stat-number');
    statNumbers.forEach(stat => {
        const finalValue = stat.textContent;
        if (!isNaN(finalValue)) {
            animateValue(stat, 0, parseInt(finalValue), 1000);
        }
    });
});

function animateValue(element, start, end, duration) {
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        element.textContent = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
            window.requestAnimationFrame(step);
        }
    };
    window.requestAnimationFrame(step);
}
</script>
{% endblock %}